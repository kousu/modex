<html>
<head>
<title> Dynamic Linegraph backed by CacheSet [backed by websockets backed by replicate.py backed by a simulation] </title>
</head>

<body>


</body>

<!--

pourover is not at all what I thought it would be
but I can probably work with it, though inefficiently
 the trouble is that pourover is heavily designed around a single use case: dataset drilldown.
  you can construct slices (MatchSets) and it has something it calls views which (using View.setSelection()) you can give particular subsets targets
  but, every view is tied back to the single global set of "filters" (a filter essentially being an parameterized where clause--unapplyed (so e.g. you can have a filter that represents "where $1 in hobbies")), and each filter
 But, I *can* replicate use its filtering 

another irritant: PourOver mutates the objects you give it, attaching a primary key (cid) to each.
 
 i just want to load my data as needed!
 I wonder how erlang handles this

crossfilter is specifically a cross-filter: each crossfilter instance is *one* view; in particular, filtering on any dimension (i.e. object property) filters all the others too, so there's no way
 at doing that one specific thing, though, an updateable view, it is excellent 

lets see if i can get a websocket talking to replicate.py, at least
 make a script that sucks less

-->

<script src="/assets/libs/json2.js"></script>
<script src="/assets/libs/underscore.js"></script>
<script src="/assets/libs/pourover.js"></script>
<script src="/assets/libs/findIndex.js"></script>
<script src="tables.js"></script>
<script src="HDRJ.js"></script>
<script>

/* HDRJCacheSet: extend CacheSet to listen to a HDRJ feed 
 *   the address should be a websocket (ws:// or wss://) URL where a replicate.py server is listening.
 */
// XXX is it possible to write this as a mixin? it would require some way to hook the constructor.
function HDRJTable(address) {
    
    var self = this;
    Table.call(this, []);
    this.feed = new HDRJ(address);
    
    this.feed.on("insert", function(row) {
        self.insert(row); //warning: 'this' is not 'self' inside these handlers
    })

    this.feed.on("update", function(old_row, new_row) {
        self.delete(old_row);
        self.insert(new_row);
    })

    this.feed.on("delete", function(row) {
        self.delete(row);
    })
}
_.extend(HDRJTable.prototype, Table.prototype);

 var DB = new HDRJTable("ws://" + location.hostname + ":8081");
 DB.on("rerender", function() {
    //console.log("The Films are now ", JSON.stringify(films._cache))
    console.log("Now have",this._cache.length, "rows.");
 })
 
 var wheat = DB.select(["time", "durumWheatConventional"])
 var organic_wheat = DB.select(["time", "durumWheatGreen"])
 /*wheat.on("rerender", function() {
   console.log("Conventional Wheat, by time, across all runs: ", _(_(this._cache).sortBy(function(o) { return o['time']})).pluck("durumWheatConventional"));
 });*/
 
/*films_tracker._feed.on("insert", function(e) { console.log("insert", e); })
films_tracker._feed.on("update", function(e) { console.log("update", e); })
films_tracker._feed.on("delete", function(e) { console.log("delete", e); })
 */ 
   
   
   
   
   
</script>

</html>